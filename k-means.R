library(factoextra)
library(cluster)
library(NbClust)

set.seed(123)
caracteristicas4500Completo <- read.csv("D:/Mestrado - UNB/Sistemas Operacionais/caracteristicas21455.csv")

dim(caracteristicas4500Completo)
caracteristicas4500=subset(caracteristicas4500Completo, select = -c(Downloads:MD5))

M1 = sweep(caracteristicas4500,1,rowSums(caracteristicas4500),"/")
 pr.out =prcomp (M1, center = TRUE, scale =FALSE)
 pc20= pr.out$x[,1:20]
 summary(pr.out)

start.time <- Sys.time()
km.res <- kmeans(M1, 9, nstart = 25)
end.time <- Sys.time()
time.taken <- end.time - start.time
time.taken


table(km.res$cluster)

c1 <- caracteristicas4500Completo[which(km.res$cluster == 1),]
c2 <- caracteristicas4500Completo[which(km.res$cluster == 2),]
c3 <- caracteristicas4500Completo[which(km.res$cluster == 3),]
c4 <- caracteristicas4500Completo[which(km.res$cluster == 4),]
c5 <- caracteristicas4500Completo[which(km.res$cluster == 5),]
c6 <- caracteristicas4500Completo[which(km.res$cluster == 6),]
c7 <- caracteristicas4500Completo[which(km.res$cluster == 7),]
c8 <- caracteristicas4500Completo[which(km.res$cluster == 8),]
c9 <- caracteristicas4500Completo[which(km.res$cluster == 9),]
c10 <- caracteristicas4500Completo[which(km.res$cluster == 10),]



write.csv(c1, file = "D:/Mestrado - UNB/Sistemas Operacionais/k-means-c1.csv")
write.csv(c2, file = "D:/Mestrado - UNB/Sistemas Operacionais/k-means-c2.csv")
write.csv(c3, file = "D:/Mestrado - UNB/Sistemas Operacionais/k-means-c3.csv")
write.csv(c4, file = "D:/Mestrado - UNB/Sistemas Operacionais/k-means-c4.csv")
write.csv(c5, file = "D:/Mestrado - UNB/Sistemas Operacionais/k-means-c5.csv")
write.csv(c6, file = "D:/Mestrado - UNB/Sistemas Operacionais/k-means-c6.csv")
write.csv(c7, file = "D:/Mestrado - UNB/Sistemas Operacionais/k-means-c7.csv")
write.csv(c8, file = "D:/Mestrado - UNB/Sistemas Operacionais/k-means-c8.csv")
write.csv(c9, file = "D:/Mestrado - UNB/Sistemas Operacionais/k-means-c9.csv")
write.csv(c10, file = "D:/Mestrado - UNB/Sistemas Operacionais/k-means-c10.csv")


# -----------------------------------------------
# total within-cluster sum of square (WSS)

set.seed(123)
# Compute and plot wss for k = 2 to k = 15
k.max <- 15 # Maximal number of clusters
data <- M1
wss <- sapply(1:k.max, 
              function(k){kmeans(data, k, nstart=10 )$tot.withinss})

plot(1:k.max, wss,
     type="b", pch = 19, frame = FALSE, 
     xlab="Number of clusters K",
     ylab="Total within-clusters sum of squares")

#--------------------------------------------------------
# silhouette width

set.seed(123)
k.max <- 15
data <- M1
sil <- rep(0, k.max)

# Compute the average silhouette width for 
# k = 2 to k = 15
for(i in 2:k.max){
  km.res <- kmeans(data, centers = i, nstart = 25)
  ss <- silhouette(km.res$cluster, dist(data))
  sil[i] <- mean(ss[, 3])
}

# Plot the  average silhouette width
#plot(1:k.max, sil, type = "b", pch = 19, frame = FALSE, xlab = "Number of clusters k")
#abline(v = which.max(sil), lty = 2)

fviz_nbclust(pc20, kmeans, method = "silhouette")

